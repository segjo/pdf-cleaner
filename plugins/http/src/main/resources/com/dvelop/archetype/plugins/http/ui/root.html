<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <link href="https://fonts.googleapis.com/css?family=Roboto:300,400,500" rel="stylesheet">
    <title th:text="${app.name}">App</title>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

<!-- Optional theme -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- Latest compiled and minified JavaScript -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

      <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
      <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
      <script src="https://cdn.service.d-velop.cloud/dapi/latest/dapi.js"></script>

    <script  type="text/javascript">

var repoId = getUrlParameter('repoId');
var docId = getUrlParameter('docId');

        $(document).ready(function () {


/*
var hosts = 100;
for(host = 0; host <= hosts; host++){
    ipToCheck = '130.'+host;
    updateProgress(host)
    $.get("demo_test.asp", function(data, status){
        host++;
       console.log("Data: " + data + "\nStatus: " + status);
  });
}*/


$.get("/document/download?docId="+docId+"&repoId="+repoId, function(data, status){
       console.log("Data: " + data + "\nStatus: " + status);
       updateProgress(25);
       getProcessDocument();

});
        });


function getProcessDocument(){
    $.get("/document/process?docId="+docId+"&repoId="+repoId, function(data, status){
       console.log("Data: " + data + "\nStatus: " + status);
       updateProgress(50);
       getUploadDocument();
});
}

function getUploadDocument(){
    $.get("/document/upload?docId="+docId+"&repoId="+repoId, function(data, status){
       console.log("Data: " + data + "\nStatus: " + status);
       updateProgress(75);
       getUpdateDocument();

});
}

function getUpdateDocument(){
    $.get("/document/update?docId="+docId+"&repoId="+repoId, function(data, status){
       console.log("Data: " + data + "\nStatus: " + status);
       updateProgress(100);
       dapi.closeResourceIfMainResource();
});
}



function getUrlParameter(sParam) {
    var sPageURL = window.location.search.substring(1),
        sURLVariables = sPageURL.split('&'),
        sParameterName,
        i;

    for (i = 0; i < sURLVariables.length; i++) {
        sParameterName = sURLVariables[i].split('=');

        if (sParameterName[0] === sParam) {
            return sParameterName[1] === undefined ? true : decodeURIComponent(sParameterName[1]);
        }
    }
    return false;
};

function updateProgress(percentage){
    if(percentage > 100) percentage = 100;
    $('#progressBar').css('width', percentage+'%');
    $('#progressBar').html(percentage+'%');
}



    </script>
</head>
<body>

    <h1>Hello, world!</h1>
    <div class="progress progress-striped active" style="height:44px;">
        <div id="progressBar" class="bar" style="height:44px;width:1%;background-color:green"></div>
    </div>

    <!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
  </body>
</html>